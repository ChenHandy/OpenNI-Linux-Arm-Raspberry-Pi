<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenNI 1.5.4: SimpleViewer.java - sample program (Java)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="OpenNILogo.bmp"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenNI 1.5.4
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">OpenNI Overview</a></li><li class="navelem"><a class="el" href="smpls_n_guides.html">Samples and Guides</a></li><li class="navelem"><a class="el" href="smpls.html">Sample Programs for the OpenNI API</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">SimpleViewer.java - sample program (Java) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Source file:</b> Click the following link to view the source code file:</p>
<ul>
<li>SimpleViewer.java</li>
</ul>
<p>This section describes the SimpleViewer sample program in the Java language. This sample program uses a DepthGenerator node to build an accumulative histogram from depth values.</p>
<p>The documentation describes the sample program's code from the top of the program file(s) to bottom.</p>
<p>Every OpenNI feature is described the first time it appears in this sample program. Further appearances of the same feature are not decribed again.</p>
<h1><a class="anchor" id="svj_glb_dcl_blk"></a>
Global Declaration Block</h1>
<pre class="fragment">The following declaration block declares the OpenNI objects required for building the OpenNI production graph. 
@code 
    private OutArg&lt;ScriptNode&gt; scriptNode;
    private Context context;
    private DepthGenerator depthGen;
    private byte[] imgbytes;
@endcode

Each of these declarations is described separately in the following paragraphs. 

The @ref xn::ScriptNode "ScriptNode" object loads an XML script from a file or string, and then runs the XML script to build a production graph . . The ScriptNode object keeps references to all nodes created from the script, so they will not be destroyed. (This is since OpenNI will delete a node that has no remaining references to it.)

A @ref xn::Context "Context" object is a workspace in which the application builds an OpenNI production graph.  

The @ref xn::DepthGenerator "DepthGenerator" node generates a depth map. Each map pixel value represents a distance from the sensor.                        

The @ref xn::DepthMetaData "DepthMetaData" object provides a @ref glos_frame_object "frame object" for the @ref xn::DepthGenerator "DepthGenerator" node. A @ref dict_gen_node "generator node's" frame object contains the generated data frame and all its associated properties. This frame object, comprising the data frame and its properties, is accessible through the node's metadata object.  

The following definition is for the path to an OpenNI XML script file for inputting and building a stored production graph. The &lt;i&gt;production graph&lt;/i&gt; is a network of &lt;i&gt;production nodes&lt;/i&gt; and is the principal OpenNI object model. The identifies blobs as hands or human users. 
@code 
    #define SAMPLE_XML_PATH "../../../../Data/SamplesConfig.xml"
@endcode        
</pre><h1><a class="anchor" id="svj_func_main"></a>
Main Program</h1>
<pre class="fragment">@subsection svj_scrpt_sets_up_pg Uses a Script to Set up a Context and Production Graph             

    The following code block uses a script to set up a context and a production graph. The &lt;b&gt;Context.createFromXmlFile()&lt;/b&gt; method is a shorthand combination of two other initialization methods, which initializes the context object and then creates a production graph from an XML file. The XML script file describes all the nodes you want to create. For each node description in the XML file, this method creates a node in the production graph.      
    @code 
        scriptNode = new OutArg&lt;ScriptNode&gt;();
        context = Context.createFromXmlFile(SAMPLE_XML_FILE, scriptNode);               
    @endcode            

@subsection svj_get_dg_node_from_pg Get a DepthGenerator Node from the Production Graph

    The following statement creates and returns a reference to a @ref xn::DepthGenerator "DepthGenerator" node. The create() method can return a reference to an existing DepthGenerator node if one already exists in the production graph created from the XML. If no DepthGenerator node already exists, this method creates a new DepthGenerator node and returns a reference to the new node.      
    @code 
        depthGen = DepthGenerator.create(context);
    @endcode

    The following statement gets the latest generated depth @ref glos_frame_object "frame object", saving it as a metadata object. 
    @code 
        DepthMetaData depthMD = depthGen.getMetaData();
    @endcode        

    The following sets up the array for the histogram array that is a key part of this sample program. (This is not OpenNI specific.)
    @code 
        histogram = new float[10000];
    @endcode                

    The following code accesses some attributes of the frame data's associated configuration properties: getFullXRes() and getFullYRes() are the full frame resolution, i.e., the entire field-of-view, ignoring cropping of the FOV in the scene.
    @code 
        width = depthMD.getFullXRes();
        height = depthMD.getFullYRes();
    @endcode        

    The remaining statements in this method are not OpenNI specific.            
    @code 
        imgbytes = new byte[width*height];

        DataBufferByte dataBuffer = new DataBufferByte(imgbytes, width*height);
        Raster raster = Raster.createPackedRaster(dataBuffer, width, height, 8, null);
        bimg = new BufferedImage(width, height, BufferedImage.TYPE_BYTE_GRAY);
        bimg.setData(raster);
    @endcode    
</pre><h1><a class="anchor" id="svj_calcHist"></a>
CalcHist() - Using the Depth Values to Build an Accumulative Histogram</h1>
<pre class="fragment">The following code block uses the depth values to build an accumulative histogram of frequency of occurrence of each depth value. The &lt;code&gt;depthMD.DepthMapPtrgetData().createShortBuffer()&lt;/code&gt;method returns a buffer that can be easily processed. The depth value is then used as an index into the histogram[] array.
@code 
    private void calcHist(DepthMetaData depthMD)
    {
        ...         
        ShortBuffer depth = depthMD.getData().createShortBuffer();
        depth.rewind();

        int points = 0;
        while(depth.remaining() &gt; 0)
        {
            short depthVal = depth.get();
            if (depthVal != 0)
            {
                histogram[depthVal]++;
                points++;
            }
        }   
        ...
        ...
    } 
@endcode
</pre><h1><a class="anchor" id="svj_update_depth_fn"></a>
updateDepth() method - Updating the Depth Map</h1>
<pre class="fragment">The following statement sets up the frame object. It is described in the &lt;a href="#getMetaData"&gt;HandTracker() method above&lt;/a&gt;.  For more explanation on this, see @ref conc_meta_data, @ref glos_frame_object, and @ref frame_data.
@code 
    DepthMetaData depthMD = depthGen.getMetaData();
@endcode    

The following method call waits for any node to have generated new data. This method then 'updates' each and every node in the entire production graph. For an overview to reading data and the &lt;b&gt;WaitXUpdateAll&lt;/b&gt; methods, see &lt;i&gt;@ref conc_updating_data__summary_of_wait_fns&lt;/i&gt;. 

the @ref xn::Context::WaitAnyUpdateAll() "waitAnyUpdateAll()" method in the following statement updates all generator nodes in the context that have new data available, first waiting for any of the nodes to have new data available. The application can then get the data (for example, using a metadata GetData() method). This method has a timeout.      
@code 
    context.waitAnyUpdateAll();
@endcode

The following code block creates a convenient buffer for the depth map and then calls the calcHist() method to calculate the histogram.
@code 
    calcHist(depthMD);
    ShortBuffer depth = depthMD.getData().createShortBuffer();              
    depth.rewind();     
@endcode

The following code block builds an image buffer according to the frequency of each depth value in the histogram. 
@code 
while(depth.remaining() &gt; 0)
    {
        int pos = depth.position();
        short pixel = depth.get();
        imgbytes[pos] = (byte)histogram[pixel];
    }       
@endcode
</pre><h1><a class="anchor" id="svj_Dimension"></a>
Dimension() method</h1>
<pre class="fragment">There are no OpenNI-specific declarations in this routine.
</pre><h1><a class="anchor" id="svj_paint"></a>
paint() method</h1>
<pre class="fragment">There are no OpenNI-specific declarations in this routine.</pre> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Mar 17 2014 17:19:11 for OpenNI 1.5.4 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
